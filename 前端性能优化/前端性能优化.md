# 前端性能优化

## 资源合并与压缩

> web前端本质上就是一种 **GUI软件** .

### 浏览器的一个请求从发送到返回都经历了什么?

![](./img/请求流程.png)

#### 本地层面的优化

1. 缓存dns, 减少查询时间 .
2. 在服务端进行HTML渲染 .

#### 网络层面优化

1. 静态资源可以放在CDN, 直接请求最近的网络环境, 注意, CDN域名避免与主站相同, 这样可以不用携带主站cookie, 可以略微减少网络开销 . 
2. 减少http请求的大小和次数 .

### 资源的合并与压缩

#### HTML压缩

1. 删除空格, 回车, 制表符等没有意义的字符.
2. 删除注释.

##### 如何进行HTML压缩

1. node.js的 **html-minifier** .
2. 后端模版引擎渲染压缩 .

#### CSS压缩

1. 删除无效代码 .
2. css语义合并 .
3. 去掉回车和空格 .

##### 如何进行CSS压缩

1. node.js的 **html-minifier** .
2. **clean-css** . 

#### JS压缩与混乱

1. 删除无效字符和注释 .
2. 代码语义的缩减和优化 .
3. 代码保护 .

##### 如何进行JS的压缩与混乱

1. **html-minifier** .
2. **uglifyjs2** .

#### 文件合并

![](./img/文件合并.png)

##### 文件合并存在的问题

- 首屏渲染问题: 文件体积增大, 如果极度依赖js文件的网页, 会等js文件完全加载完毕才渲染网页, 这样, 会白屏很长时间 .
- 缓存失效问题:  浏览器缓存js文件, 会带一个md5的戳, 当你讲多个js文件合并成一个大的js文件后, 但凡一点点改动, 浏览器都会重新加载整个大的js文件, 继而缓存失效, 如果不合并, 就只会加载某一个被改变的js, 剩下的都可以从缓存里取 .

基于上述条件, 我们合并的文件, 主要选择公共库, 不同的页面进行合并(SPA) .

## 图片相关优化

### CSS雪碧图

- 减少HTTP请求数量 .
- 图片较大时, 一次加载比较慢 .

### Image inline

> 将图片的内容内嵌到html当中, 当做一个base-64的格式, 可以减少HTTP请求数量, 常用于体积比较小的图片 .